From a68b5c809a99110a87c0c6363602c841294e17a7 Mon Sep 17 00:00:00 2001
From: Eduardo Habkost <ehabkost@redhat.com>
Date: Tue, 12 Jun 2018 17:49:13 -0300
Subject: [PATCH 3/3] i386: define the AMD 'virt-ssbd' CPUID feature bit
 (CVE-2018-3639)
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

RH-Author: Eduardo Habkost <ehabkost@redhat.com>
Message-id: <20180612174913.3977-3-ehabkost@redhat.com>
Patchwork-id: 80643
O-Subject: [RHEL-6.10 qemu-kvm PATCH 2/2] i386: define the AMD 'virt-ssbd' CPUID feature bit (CVE-2018-3639)
Bugzilla: 1574074
RH-Acked-by: Igor Mammedov <imammedo@redhat.com>
RH-Acked-by: Wainer dos Santos Moschetta <wainersm@redhat.com>
RH-Acked-by: Miroslav Rezanina <mrezanin@redhat.com>

From: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>

AMD Zen expose the Intel equivalant to Speculative Store Bypass Disable
via the 0x80000008_EBX[25] CPUID feature bit.

This needs to be exposed to guest OS to allow them to protect
against CVE-2018-3639.

Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
Reviewed-by: Daniel P. Berrangé <berrange@redhat.com>
Signed-off-by: Daniel P. Berrangé <berrange@redhat.com>
Message-Id: <20180521215424.13520-3-berrange@redhat.com>
Signed-off-by: Eduardo Habkost <ehabkost@redhat.com>
(cherry picked from commit 403503b162ffc33fb64cfefdf7b880acf41772cd)

Conflicts:
    target/i386/cpu.c is target-i386/cpuid.c

Signed-off-by: Eduardo Habkost <ehabkost@redhat.com>
Signed-off-by: Wainer dos Santos Moschetta <wainersm@redhat.com>
---
 target-i386/cpuid.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/target-i386/cpuid.c b/target-i386/cpuid.c
index fb43bff0c1..31149327ce 100644
--- a/target-i386/cpuid.c
+++ b/target-i386/cpuid.c
@@ -110,7 +110,7 @@ static const char *cpuid_8000_0008_ebx_feature_name[] = {
     "ibpb", NULL, NULL, NULL,
     NULL, NULL, NULL, NULL,
     NULL, NULL, NULL, NULL,
-    NULL, NULL, NULL, NULL,
+    NULL, "virt-ssbd", NULL, NULL,
     NULL, NULL, NULL, NULL,
 };
 
-- 
2.13.6

